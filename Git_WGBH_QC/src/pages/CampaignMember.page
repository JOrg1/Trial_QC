<apex:page standardController="Campaign" extensions="CampaignMemberClass" tabStyle="Campaign" id="pg" showHeader="true" sidebar="true">
<apex:includeScript value="/soap/ajax/16.0/connection.js"/>
    
    <style>
    .activeTab {background-color: #236FBD; color:white; background-image:none}
    .inactiveTab { background-color: lightgrey; color:black; background-image:none}
    </style>

    <apex:sectionHeader title="Campaign/Program" subtitle="Manage Members"/>
    Â«<a href="/{!Campaign.Id}">Back to Campaign/Program: {!Campaign.Name}</a>
    <BR/>
    <BR/>
    <apex:pagemessages id="msgPage"></apex:pagemessages>
    
    <apex:form id="pf">

        <apex:inputhidden id="hdnQueryId" value="{!QueryId}"/>
        <apex:inputhidden id="hdnCallBatch" value="{!blnCallBatch}"/>
        <apex:commandButton id="tabAddMember" title="Add Members" disabled="{!blnAddmember}" value="Add Members" onclick="selectTab('0', 'ADDMEMBER');" action="{!tabClick}"/>
        <apex:commandButton id="tabExistingMember" title="{!lblExistingMembers}" disabled="{!blnExistingMember}" value="{!lblExistingMembers}" onclick="selectTab('1', 'EXISTINGMEMBER');" action="{!tabClick}" />
        <apex:pageblock id="pbExistingMember" rendered="{!blnExistingMember}">        
        <table width="80%" border="0" bordercolor="red">
            <tr>
                <td width="50%">
                    <apex:outputPanel id="SearchCriteriaExisting">
                        <apex:dataTable value="{!ListCriteriaExisting}" var="l">
                            <apex:column headerValue="Field" width="35%">
                                <apex:selectList style="width:250px" id="fieldList" value="{!l.SelectedField}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!l.FieldList}"/>
                                    <apex:actionSupport event="onchange" id="selectField"
                                        action="{!CheckFieldTypeExisting}" 
                                        rerender="icon1,operator1,pnlCondition" status="Status"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="Operator" width="25%">
                                <apex:selectList style="width:153px" id="operator1" value="{!l.SelectedOperator}" multiselect="false" size="1">
                                    <apex:selectOptions value="{!l.Operators}"/>
                                </apex:selectList>                    
                            </apex:column>
                            <apex:column headerValue="Value"  width="30%">
                                <apex:inputText id="value" value="{!l.Value}" style="width:200px"/>                                
                            </apex:column>
                            <apex:column width="5%">
                                <apex:outputpanel id="icon1">
                                    <apex:image rendered="{!RIGHT(l.SelectedField,8)=='picklist'}" styleclass="lookupIcon" title="Poduct Lookup (New Window)" 
                                    onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
                                    value="/s.gif"   id="hyperParent" onclick="callLookupParentCampaign(id,'{!l.SelectedField}');"  />
                                </apex:outputpanel>
                            </apex:column>
                            <apex:column width="5%">
                                <apex:outputpanel id="pnlCondition">
                                    <apex:selectList style="width:70px" value="{!l.selectedCondition}" multiselect="false" size="1">
                                        <apex:selectOptions value="{!l.Conditions}"/>
                                    </apex:selectList>    
                                </apex:outputpanel>
                            </apex:column>
                        </apex:dataTable> 
                    </apex:outputPanel>      
                </td>
                <td width="50%">
                </td>
            </tr>
                <tr>
                    <td width="50%" style="text-align:right">
                        <apex:commandLink action="{!resetFilterExisting}" title="Clear Filter" value="Clear Filters" reRender="SearchCriteriaExisting"/>
                    </td>
                    <td width="50%">
                    </td>
                </tr>
            <tr>
                <td width="50%" style="text-align:left">
                    <apex:commandButton title="Add Row" value="Add Row" action="{!AddNewSearchRowExisting}" reRender="SearchCriteriaExisting"/>
                    <apex:commandButton value="Go!" title="Go!" action="{!GoForExistingMember}" reRender="pbExistingMemberList"/>
                </td>
                <td width="50%">
                </td>
            </tr> 
        </table>
        </apex:pageblock>
        <apex:pageblock id="pbExistingMemberList" rendered="{!blnExistingMember}">
            <apex:commandButton id="remove" title="Remove" action="{!removeSelected}" value="Remove"/>
            <apex:commandButton id="updateStatus" action="{!updateStatus}" title="Update Status" value="Update Status"/>
            <apex:selectList title="Select Status" id="status" value="{!selectedStatusExisting}" multiselect="false" size="1">
                <apex:selectOptions value="{!Status}"/>
            </apex:selectList>
            <apex:pageblocktable id="tblExistingMember" value="{!ExistingMember}" var="c">
                <apex:column width="15%">
                    <apex:facet name="header"> 
                        <apex:outputPanel >
                            <apex:inputCheckbox title="Action" value="{!blnAllMemberSelected}" >
                            <apex:actionSupport status="counterStatusSelectAll" action="{!selectAllMember}" rerender="tblExistingMember" event="onclick"/>                            
                            <apex:actionStatus id="counterStatusSelectAll" 
                               startText=" (Please Wait...)" 
                               stopText=""/>
                            </apex:inputCheckbox>
                        </apex:outputPanel>
                        
                    </apex:facet>
                    <div id="{!c.memberId}_ACTION_COLUMN_Edit" class="x-grid3-cell-inner x-grid3-col-ACTION_COLUMN">
                        <apex:inputcheckbox id="selectRow" value="{!c.selected}"/>&nbsp;
                        <apex:outputLink onclick="return editMember('{!c.MemberType}','{!c.LeadId}','{!c.ContactId}');" >Edit</apex:outputLink>
                        &nbsp;| &nbsp;
                        <apex:commandLink action="{!removeSingle}" onclick="return removeMember('{!c.memberId}');">Remove</apex:commandLink>
                    </div>
                </apex:column>
                <apex:column width="15%" headerValue="Name">
                    <apex:outputlink value="/{!c.memberId}">{!c.Name}</apex:outputlink>
                </apex:column>
                <apex:column width="10%" headerValue="Title" value="{!c.Title}"/>
                <apex:column width="15%" headerValue="Company" value="{!c.Company}"/>
                <apex:column width="15%" headerValue="Email" value="{!c.Email}"/>
                <apex:column width="10%" headerValue="Type">
                    <apex:outputlink value="/{!c.LeadId}" rendered="{!if(c.MemberType=='LEAD',true,false)}">{!$ObjectType.Lead.label}</apex:outputlink>
                    <apex:outputlink value="/{!c.ContactId}" rendered="{!if(c.MemberType=='CONTACT',true,false)}">{!$ObjectType.Contact.label}</apex:outputlink>
                </apex:column>
                <apex:column width="10%" headerValue="Status" value="{!c.Status}"/>
                <apex:column width="10%" headerValue="Last Modified Date">
                     <apex:outputText value="{0,date,MM/dd/yyyy}">
                         <apex:param value="{!c.LastModifiedDate}"  />
                     </apex:outputText>
                </apex:column>
            </apex:pageblocktable>
            <table width="100%">
                <tr>
                    <td>
                        <apex:outputPanel id="PageInfo" rendered="{!blnExistingMember}">
                            <strong>Page:&nbsp;{!pageNumber}/{!totalPage}&nbsp;&nbsp;&nbsp;&nbsp;Records:&nbsp;{!FromRecords}-{!ToRecords}&nbsp;({!TotalRecords})</strong>
                        </apex:outputPanel>
                    </td>
            
                    <td align="right">
                        <apex:outputPanel id="pnlPaging" rendered="{!blnExistingMember}">
                            <apex:commandButton value="Previous" title="Previous" action="{!PreviousPage}" reRender="pbExistingMemberList, PageInfo, pnlPaging" status="status" />
                            <apex:outputText value="Previous" title="Previous" rendered="false" />&nbsp;|&nbsp;&nbsp;
                            <apex:commandButton value="Next" title="Next" action="{!NextPage}" reRender="pbExistingMemberList, PageInfo, pnlPaging" status="status" />
                            <apex:outputText value="Next" title="Next" rendered="false" />
                        </apex:outputPanel>
                    </td>
                </tr>
            </table> 
        </apex:pageblock>
        
        
        <apex:pageblock id="pbAddMember" rendered="{!blnAddmember}">
            <div class="mmSubheader"><b>Step 1: Choose Member Type to Search</b></div>
                <b>
                    <apex:outputPanel >
                        <apex:actionSupport event="onchange" status="counterStatus1" reRender="SearchCriteria,template,addContactResult,PageInfo1,pnlPaging1"
                            action="{!SelectSearchType}"/> 
                        <apex:selectRadio value="{!SelectedSearch}">
                            <apex:selectOptions value="{!SearchType}">
                                <apex:actionStatus id="counterStatus1" startText=" (Please Wait...)" stopText=""/>
                            </apex:selectOptions>
                        </apex:selectRadio>
                        
                    </apex:outputPanel>
                </b>
            <div class="mmSubheader"><b>Step 2: Specify Filter Criteria</b></div>
            <table width="100%" border="0" bordercolor="red">
                <tr>
                    <td width="50%">
                        <table width="100%" border="0" bordercolor="blue">
                            <tr>
                                <td>
                                    <apex:outputPanel id="SearchCriteria">
                                        <apex:dataTable value="{!ListCriteria}" var="l">
                                            <apex:column width="5%">
                                                <apex:outputText >{!l.RowNo}&nbsp; </apex:outputText>
                                            </apex:column>
                                            <apex:column headerValue="Field" width="40%">
                                                <apex:selectList style="width:250px" id="fieldList" value="{!l.SelectedField}"  multiselect="false" size="1">
                                                    <apex:selectOptions value="{!l.FieldList}"/>
                                                    <apex:actionSupport status="counterStatusSelectField" event="onchange" id="selectField"
                                                        action="{!CheckFieldType}" 
                                                        rerender="icon,operator,pnlValue,pnlCondition"/>
                                                    <apex:actionStatus id="counterStatusSelectField" 
                                                       startText=" (Please Wait...)" 
                                                       stopText=""/>
                                                </apex:selectList>
                                            </apex:column>
                                            <apex:column headerValue="Operator" width="25%">
                                                <apex:selectList style="width:120px" id="operator" value="{!l.SelectedOperator}" multiselect="false" size="1">
                                                    <apex:selectOptions value="{!l.Operators}"/>
                                                </apex:selectList>                    
                                            </apex:column>
                                            <apex:column headerValue="Value"  width="25%">                                    
                                                <apex:outputpanel id="pnlValue">
                                                    <apex:inputText id="value" value="{!l.Value}" style="width:225px" rendered="{!RIGHT(l.SelectedField,8)!='Checkbox' && RIGHT(l.SelectedField,4)!='Date' && RIGHT(l.SelectedField,8)!='DateTime'}" />
                                                    <apex:inputCheckbox id="chkValue" value="{!l.checkbox}"  rendered="{!RIGHT(l.SelectedField,8)=='Checkbox'}" />                             
                                                    <apex:inputField style="width:110px" required="false" id="dtDate" value="{!l.datePicker.closedate}"  rendered="{!RIGHT(l.SelectedField,4)=='Date'}" />                     
                                                    <apex:inputField style="width:110px" required="false" id="dtDateTime" value="{!l.datePicker.Gift_Date_Time__c}"  rendered="{!RIGHT(l.SelectedField,8)=='DateTime'}" />
                                                </apex:outputpanel>
                                            </apex:column>
                                            <apex:column width="5%">
                                                <apex:outputpanel id="icon">
                                                    <apex:image rendered="{!RIGHT(l.SelectedField,8)=='Picklist'}" styleclass="lookupIcon" title="Lookup (New Window)" 
                                                    onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
                                                    value="/s.gif"   id="hyperParent" onclick="callLookupParentCampaign(id,'{!l.SelectedField}');"  />
                                                </apex:outputpanel>
                                            </apex:column>
                                            <apex:column width="5%">
                                                <apex:outputpanel rendered="{!if(l.Status=='Processing',true,false)}">
                                                    <img class="waitingImage" src="/img/loading.gif" title="Please Wait..."/>
                                                </apex:outputpanel>
                                                <apex:outputpanel rendered="{!if(l.Status=='Completed',true,false)}">
                                                    <img class="checkImg" title="Completed" alt="Completed" src="/img/msg_icons/confirm16.png"/>                                        
                                                </apex:outputpanel>
                                            </apex:column>
                                        </apex:dataTable>
                                        <apex:outputPanel id="pnlDiv" rendered="{!blnLoadDiv}">
                                            <c:LoadingDiv ></c:LoadingDiv>
                                        </apex:outputPanel>
                                    </apex:outputPanel>   
                                                                
                                </td>                            
                            </tr>
                            
                            <tr>
                                <td style="text-align:right">
                                    <!--<apex:commandLink action="{!resetFilterAdd}" title="Clear Filters" value="Clear Filters" rerender="pbAddMember"/>-->
                                    <apex:outputpanel id="pnlAdvanceFilter">
                                        <table cellpedding="0" cellspacing="0" border="0" width="100%" bordercolor="red">
                                            <tr>
                                                <td width="85%" style="text-align:left" align="left">
                                                    Advance Filter
                                                    <apex:inputcheckbox id="chkAdvanceFilter" value="{!blnAdvanceFilter}"/>
                                                    <apex:inputTextarea rows="3" style="width:450px" disabled="false" id="txtAdvanceFilter" value="{!AdvanceFilter}"/>
                                                </td>
                                                <td width="15%" style="text-align:right">
                                                    <apex:commandLink action="{!resetFilterAdd}" title="Clear Filters" value="Clear Filters" rerender="pbAddMember"/>
                                                </td>
                                            </tr>
                                        </table>
                                   </apex:outputpanel>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:left">
                                    <apex:commandButton title="Add Row" value="Add Row" action="{!AddNewSearchRow}" reRender="SearchCriteria"/>
                                    <!--<apex:commandButton title="Go!" value="Go111!" status="goStatus" action="{!SubmitRequest}" reRender="addContactResult,PageInfo1,pnlPaging1"/>-->
                                    <apex:commandButton rendered="false" title="Go!" value="Go!" status="goStatus" action="{!Go}" reRender="addContactResult,PageInfo1,pnlPaging1"/>
                                    <apex:commandButton rendered="false" title="Go!" value="Generate Query" status="goStatus" action="{!SubmitRequest}" reRender="hdnQueryId,hdnCallBatch,addContactResult,PageInfo1,pnlPaging1"/>
                                    <!--<apex:commandButton title="Go!" value="Call Batch" status="goStatus" onclick="return checkStatus();" reRender="pnlDiv,hdnQueryId,hdnCallBatch,addContactResult,PageInfo1,pnlPaging1"/>-->                        
                                    <apex:actionFunction action="{!batch}" oncomplete="return recallme();" status="goStatus"  reRender="pnlDiv,SearchCriteria,hdnQueryId,hdnCallBatch,addContactResult,PageInfo1,pnlPaging1"  name="callBatch"/>
                                    <apex:commandButton title="Go!" value="Go!" action="{!batch}" status="goStatus" reRender="msgPage,hdnQueryId,hdnCallBatch,addContactResult,PageInfo1,pnlPaging1"/>
                                    <apex:actionStatus id="goStatus" 
                                       startText=" (Please Wait...)" 
                                       stopText=""/>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td width="50%">
                        <table width="100%" border="0" bordercolor="red">
                            <tr>
                                <td width="25%">
                                    Template Group:
                                </td>
                                <td width="75%">
                                    <apex:outputPanel >
                                        <apex:actionSupport event="onchange" status="counterStatusGroup" reRender="pnlTemplate,SearchCriteria,pg:pf:addContactResult,pnlAdvanceFilter"
                                            action="{!changeExistingView}"/>
                                        <apex:selectList id="templateGroup" value="{!selectedGroup}" multiselect="false" size="1">
                                            <apex:selectOptions value="{!TemplateGroup}"/>
                                        </apex:selectList>
                                        <apex:actionStatus id="counterStatusGroup" 
                                               startText=" (Please Wait...)" 
                                               stopText=""/>
                                    </apex:outputPanel>
                                </td>
                            </tr>
                            <tr>
                                <td width="25%">
                                    Use Template:
                                </td>
                                <td width="75%">
                                    <apex:outputPanel id="pnlTemplate">
                                        <apex:actionSupport event="onchange" status="counterStatus" reRender="SearchCriteria,pg:pf:addContactResult,pnlAdvanceFilter"
                                            action="{!changeExistingView}"/>
                                        <apex:selectList id="template" value="{!SelectedView}" multiselect="false" size="1">
                                            <apex:selectOptions value="{!ExistingViews}"/>
                                        </apex:selectList>
                                        <apex:actionStatus id="counterStatus" 
                                               startText=" (Please Wait...)" 
                                               stopText=""/>
                                    </apex:outputPanel>
                                </td>
                            </tr>
                            <tr>
                                <td width="25%">
                                    <apex:inputText id="txtTemplateName" value="{!templateName}" style="width:150px"/>
                                </td>
                                <td width="75%">
                                    <apex:commandButton title="Save As Template" value="Save As Template" onclick="return saveTemplate();" action="{!SaveTemplate}"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                
            </table>
        </apex:pageblock>
        <apex:pageblock id="addContactResult" rendered="{!blnAddmember}">
            
            <!--<apex:commandButton id="addWithStatus" action="{!addMember}" onclick="return addWithStatus_click(id);" 
            title="Add with Status" value="Add with Status"/>-->
            
            <apex:commandButton id="addWithStatus" onclick="return addWithStatus_click(id);" 
            title="Add with Status" value="Add with Status"/>
            
            <apex:actionFunction action="{!batchAddMember}" oncomplete="return recallAddMember();" status="goStatus"  reRender="pg:pf:addContactResult:pnlMemberDiv"  name="batchAddMember"/>
            <apex:actionFunction action="{!reloadExistingMembers}" status="goStatus"  reRender="pg:pf:addContactResult:pnlMemberDiv"  name="reloadExistingMembers"/>
            
            &nbsp;
            <apex:outputPanel id="pnlMemberDiv" rendered="{!blnLoadDiv}">
                <c:LoadingDiv ></c:LoadingDiv>
            </apex:outputPanel>
            <apex:selectList title="Select Status" id="status" value="{!selectedStatus}" multiselect="false" size="1">
                <apex:selectOptions value="{!Status}"/>
            </apex:selectList>
            &nbsp;
            <apex:outputpanel rendered="{!if(mode=='batch',true,false)}">
                <apex:outputLink onclick="return redirectToNewWindow('{!reportURL}','')" value="{!reportURL}">Â«View All Search Result in SF Report</apex:outputLink>
            </apex:outputpanel>
            <br/>
            <br/>
            <apex:pageblocktable id="tblContactResult" rendered="{!if(SelectedSearch=='CONTACT',true,false)}" 
            value="{!ContactResult}" var="c"> 
                <apex:column headerValue="Select">               
                    <apex:facet name="header"> 
                        <apex:outputPanel >
                            <apex:inputCheckbox onclick="return selectAll(this);" title="Action" value="{!blnAllRowSelected}" >                            
                            </apex:inputCheckbox>
                        </apex:outputPanel>                    
                    </apex:facet>
                    <apex:inputcheckbox id="selectRow" value="{!c.selected}"/>
                </apex:column>
                <apex:column headerValue="First Name">
                    <!--<apex:outputLink value="/{!c.objContact.Id}">{!c.objContact.FirstName}</apex:outputLink>-->
                    <apex:outputLink value="/{!c.ContactId}">{!c.FirstName}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Last Name">
                    <!--<apex:outputLink value="/{!c.objContact.Id}">{!c.objContact.LastName}</apex:outputLink>-->
                    <apex:outputLink value="/{!c.ContactId}">{!c.LastName}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Company Title" value="{!c.Title}"/>
                <apex:column headerValue="Company">
                    <!--<apex:outputLink value="/{!c.objContact.AccountId}">{!c.objContact.Account.Name}</apex:outputLink>-->
                    <apex:outputLink value="/{!c.AccountId}">{!c.AccountName}</apex:outputLink>
                </apex:column>
                <!--<apex:column headerValue="Email" value="{!c.objContact.Email}"/>-->
                <apex:column headerValue="Email" value="{!c.Email}"/>
                <apex:column headerValue="Campaign/Program Member Status" value="{!c.MemberStatus}"/>
            </apex:pageblocktable>
            
            <apex:pageblocktable id="tblLeadResult" rendered="{!if(SelectedSearch=='LEAD',true,false)}" 
            value="{!LeadResult}" var="c">
                <apex:column headerValue="Select">
                    <apex:inputcheckbox id="selectRow" value="{!c.selected}"/>
                </apex:column>
                <apex:column headerValue="First Name">
                    <apex:outputLink value="/{!c.LeadId}">{!c.FirstName}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Last Name">
                    <apex:outputLink value="/{!c.LeadId}">{!c.LastName}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Company Title" value="{!c.Title}"/>
                <apex:column headerValue="Company">
                    <apex:outputLink value="/{!c.LeadId}">{!c.AccountName}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Email" value="{!c.Email}"/>
                <apex:column headerValue="Campaign/Program Member Status" value="{!c.MemberStatus}"/>
            </apex:pageblocktable>
            <BR/>
            <div class="x-grid-empty" style="width: 500px;">
            {!refreshed}
            </div>
            <table width="100%">
                <tr>
                    <td>
                        <apex:outputPanel id="PageInfo1" rendered="{!blnAddmember}">
                            <strong>Page:&nbsp;{!pageNumber}/{!totalPage}&nbsp;&nbsp;&nbsp;&nbsp;Records:&nbsp;{!FromRecords}-{!ToRecords}&nbsp;({!TotalRecords})</strong>
                        </apex:outputPanel>
                    </td>
            
                    <td align="right">
                        <apex:outputPanel id="pnlPaging1" rendered="{!blnAddmember}">
                            <apex:commandButton value="Previous" title="Previous" action="{!PreviousPage}" reRender="addContactResult, PageInfo1, pnlPaging1" status="status" />
                            <apex:outputText value="Previous" title="Previous" rendered="false" />&nbsp;|&nbsp;&nbsp;
                            <apex:commandButton value="Next" title="Next"  action="{!NextPage}" reRender="addContactResult, PageInfo1, pnlPaging1"/>
                            <apex:outputText value="Next" title="Next" rendered="false" />
                        </apex:outputPanel>
                    </td>
                </tr>
            </table> 
        </apex:pageblock>
        <apex:inputHidden id="hdnActiveTab" value="{!ActiveTab}"/>
        <apex:inputHidden id="hdnTabIndex" value="{!TabIndex}"/>
    </apex:form>
    <script>
    ///////////////////////////////////////////////////
    function redirectToNewWindow(TargetPage,TargetName)
    {
        var sURL = String(window.location);
        var substr = sURL.substring(sURL.lastIndexOf("/"),sURL.length);
        sURL = sURL.replace(substr,"/" + TargetPage);
        openFullScreeWindow(TargetPage,TargetName);
        return false;
    }
    function openFullScreeWindow( aURL, aWinName )
    {
       var wOpen;
       var sOptions;

       sOptions = 'status=yes,menubar=yes,scrollbars=yes,resizable=yes,toolbar=yes';
       sOptions = sOptions + ',width=' + (screen.availWidth - 10).toString();
       sOptions = sOptions + ',height=' + (screen.availHeight - 122).toString();
       sOptions = sOptions + ',screenX=0,screenY=0,left=0,top=0';

       wOpen = window.open( '', aWinName, sOptions );
       wOpen.location = aURL;
       wOpen.focus();
       wOpen.moveTo( 0, 0 );
       wOpen.resizeTo( screen.availWidth, screen.availHeight );
       return wOpen;
    }
    ///////////////////////////////////////////////////    
    function selectAll(id){
        var selectedCount = 0;
        ///alert(id);
        //alert(id.value);
        //alert(id.checked);
        var element;
        var controlname; 
        //var chk = document.getElementById(id).value;
        //alert(chk);
        for(var j = 0; j < document.forms.length; j++){
            for (var i = 0; i < document.forms[j].elements.length; i++)
            {
                element = document.forms[j].elements[i];
                if(element.type.toUpperCase() == 'CHECKBOX'){
                    var tempid = document.forms[j].elements[i].id;
                    controlname = tempid.substring(tempid.lastIndexOf(":")+1,tempid.length);
                    
                    //pg:pf:addContactResult:tblContactResult:1:selectRow
                    
                    if(controlname.toUpperCase() == 'SELECTROW'){
                        var str = "pg:pf:addContactResult:tblContactResult:" + i + ":selectRow";
                        document.getElementById(str).checked = id.checked;
                    }
                }
            }
        }
        return false;
    }
    function searchControl(type, name){
        var selectedCount = 0;
        var element;
        var controlname; 
        for(var j = 0; j < document.forms.length; j++){
            for (var i = 0; i < document.forms[j].elements.length; i++)
            {
                element = document.forms[j].elements[i];
                if(element.type.toUpperCase() == type.toUpperCase()){
                    var tempid = document.forms[j].elements[i].id;
                    controlname = tempid.substring(tempid.lastIndexOf(":")+1,tempid.length);
                    if(controlname.toUpperCase() == name.toUpperCase())
                        return tempid;
                }                
            }
        }            
    }
    ///////////////////////////////////////////////////    
    var mins,secs,TimerRunning,TimerID;
     TimerRunning=false;
     
        function addWithStatus_click(id){
            var status = document.getElementById(id.replace('addWithStatus','status'));
            if(status.value == null || status.value == "--None--" || status.value == "undefined"){
                alert("Select Status");
            }
            //return true;
            //////////////newly added////////////
            pg:pf:addContactResult:j_id131:batchAddMember();
            //pg:pf:addContactResult:j_id128:batchAddMember();
            /////////////////////////////////////
        }
        
        function checkBatchStatus(){
            
            var classId = "{!strBatchAddCampaignMemberId}";
            //alert(classId);
            var job = sforce.connection.query("Select Status From AsyncApexJob Where APEXCLASSID = '" + classId + "' Order By CREATEDDATE desc limit 1");
            var lstJob =  new sforce.QueryResultIterator(job);
            var jobStatus;
            while (lstJob.hasNext()){
                var request = lstJob.next();
                jobStatus = request.Status;
            }           
            alert('Batch Status : ' + jobStatus); 
            if(jobStatus == 'Completed'){
                pg:pf:addContactResult:j_id129:reloadExistingMembers();
            }
            if(TimerRunning)
               clearTimeout(tTimer);            
        }
        var tTimer;
        function recallAddMember(){
            tTimer = setTimeout("checkBatchStatus()",4000);
        }
        
     function recallme(){
         var hdnCallBatch = document.getElementById(searchControl('hidden','hdnCallBatch')).value;  
         if(hdnCallBatch == true){
             Init();
             return false;
         }
         else{
             //alert('All batches completed');
             return false;
         }
     }
     function checkStatus(){
         pg:pf:pbAddMember:j_id117:callBatch();
         Init();
         return false;
     }
     function Init() //call the Init function when u need to start the timer
     {
        mins=15;
        secs=0;
        StopTimer();
        StartTimer();
     }
     
 
     function StopTimer()
     {
        if(TimerRunning)
           clearTimeout(TimerID);
        TimerRunning=false;
     }
     function callBatchApex(){
        sforce.connection.sessionId = '{!$Api.Session_ID}';
        var hdnCallBatch = document.getElementById(searchControl('hidden','hdnCallBatch')).value;  
        var hdnQueryId = document.getElementById(searchControl('hidden','hdnQueryId')).value;  
        var currentIndex;
        var result = sforce.connection.query("Select Status__c, Id, Index__c From Requested_Search__c Where Id='" + hdnQueryId + "'");
        var it = new sforce.QueryResultIterator(result);
        var status;
        var id;
        while (it.hasNext()) {
            var request = it.next();
            status = request.Status__c;
            id = request.Id;
            //currentIndex = request.Index__c.replace('.0','');
            //currentIndex = parseInt(currentIndex) - 1;
        }
        //alert('Status : ' + status);
        var classId = "{!strBatchExecSearchRequestId}";
        //alert(classId);
        var job = sforce.connection.query("Select Status From AsyncApexJob Where APEXCLASSID = '" + classId + "' Order By CREATEDDATE desc limit 1");
        var lstJob =  new sforce.QueryResultIterator(job);
        var jobStatus;
        while (lstJob.hasNext()){
            var request = lstJob.next();
            jobStatus = request.Status;
        }
        //alert('Job Status : ' + jobStatus);
        
        //alert(currentIndex);
        //var lblStatus = document.getElementById("pg:pf:pbAddMember:j_id95:" + currentIndex + ":lblStatus");
        //alert(lblStatus);
        //lblStatus.value = jobStatus;
        if((status == 'Completed' || status == 'Closed') && (jobStatus == 'Completed')){
            hdnQueryId = id;
            pg:pf:pbAddMember:j_id117:callBatch();
        }
     }
     function StartTimer()
     {
        TimerRunning=true;
        window.status="Time Remaining "+Pad(mins)+":"+Pad(secs);
        //alert("Time Remaining "+Pad(mins)+":"+Pad(secs));
        callBatchApex();
        TimerID = setTimeout("StartTimer()",4000);
        Check();
        /*
        if(mins==0 && secs==0)
           StopTimer();
        
        if(secs==0)
        {
           mins--;
           secs=60;
        }
        secs--;
        */
     }
     
     function Check()
     {

        //pg:pf:pbAddMember:j_id117:callBatch();
        if(mins==5 && secs==0)
           alert("You have only five minutes remaining");
        else if(mins==0 && secs==0)
        {
           alert("Your alloted time is over.");
        }
     }
     
     function Pad(number) //pads the mins/secs with a 0 if its less than 10
     {
        if(number<10)
           number=0+""+number;
        return number;
     }
    ///////////////////////////////////////////////////
        function editMember(Type, LeadId, ContactId){
            var url = '';
            var id = '';
            if(Type == 'LEAD'){
                id = LeadId;
            }
            if(Type == 'CONTACT'){
                id = ContactId;
            }
            //url = id + "/e?retURL=%2F" + id;
            url = id + "/e?retURL=%2Fapex%2FCampaignMember?id={!$CurrentPage.parameters.id}";
            
            redirectToPage(url);
            return false;
        }
        function redirectToPage(TargetPage)
        {
            var sURL = String(window.location);
            var substr = sURL.substring(sURL.lastIndexOf("/apex/"),sURL.length);
            sURL = sURL.replace(substr,"/" + TargetPage);
            //alert(sURL);
            window.location = sURL;
            return false;
        }
        function removeMember(id){
            if(confirm("Are you sure?")==true){
                deleteMember(id);
                return true;
            }else{
                return false;
            }
        }
        function deleteMember(id){
            var temp = id.split(",");
            sforce.connection.sessionId = '{!$Api.Session_ID}';
            result = sforce.connection.deleteIds(temp);
        }
        function selectTab(tabIndex, tabName){
            var ActiveTab = document.getElementById(searchControl("hidden","hdnActiveTab"));
            var TabIndex = document.getElementById(searchControl("hidden","hdnTabIndex"));
            
            ActiveTab.value = tabName;
            TabIndex.value = tabIndex;
        }
        function defaultOperator(id){
            //var fieldList = document.getElementById(id);
            //var operator = document.getElementById(id.replace('fieldList','operator'));
            //selectField
            var fieldList = document.getElementById(id.replace('selectField','fieldList'));
            var operator = document.getElementById(id.replace('selectField','operator'));
            if(fieldList.selectedIndex > 0){
                if(operator.selectedIndex <= 0){
                    operator.selectedIndex = 1;
                }
            }
            else{
                operator.selectedIndex = 0;
            }
            return true;
        }
        function saveTemplate(){
            var txtTemplateName = document.getElementById(searchControl('text','txtTemplateName'));
            if(txtTemplateName.value.length == 0){
                alert("Template name cannot be blank!");
                txtTemplateName.focus();
                return false;
            }
            return true;
        }
        function setAdvanceFilter(id){
            var chk = document.getElementById(id);
            var txtAdvanceFilter = document.getElementById(searchControl('text','txtAdvanceFilter'));
            //alert(chk.checked);
            if(chk.checked == true){
                txtAdvanceFilter.disabled = false;
            }
            else{
                txtAdvanceFilter.disabled = true;
                txtAdvanceFilter.value='';
            }
            //return false;
        }
        function callLookupParentCampaign(id,field){
            //alert(field);
            //var URL =  '/apex/Lookup?value=' + productName + '&pricebook=' + priceBook + '&index=' + index;   
            var arrField = field.split(";");
            var objectName = arrField[0];
            var fieldName = arrField[1];
            var value = id.replace('hyperParent','value');
            //alert('Object -> ' + objectName + ' ; Field Name -> ' + fieldName + ' ; Value -> ' + value);
            //return false;
            var URL =  '/apex/Lookup?object=' + objectName + '&field=' + fieldName;
            var newwindow = window.showModalDialog(URL,'','dialogWidth:620px; dialogHeight:400px; center:yes; resizable:no');
            if(newwindow != null){
                document.getElementById(value).value = newwindow;
                
                //var arrRet = newwindow.split('#');
                
                //selectedPricebook2Id.value = arrRet[0];
            }
        }
        
        function searchControl(type, name){
            var selectedCount = 0;
            var element;
            var controlname; 
            for(var j = 0; j < document.forms.length; j++){
                for (var i = 0; i < document.forms[j].elements.length; i++)
                {
                    element = document.forms[j].elements[i];
                    if(element.type.toUpperCase() == type.toUpperCase()){
                        var tempid = document.forms[j].elements[i].id;
                        controlname = tempid.substring(tempid.lastIndexOf(":")+1,tempid.length);
                        if(controlname.toUpperCase() == name.toUpperCase())
                            return tempid;
                    }                
                }
            }            
        }

    jQuery.noConflict();
 
        jQuery(document).ready( function() {
        var myElement = document.getElementById("{!$Component.pageId:formId:myComponentId}");
        jQuery(myElement).focus();
        } );
        
        var AgreementForm = document.getElementById("salesforceSource_blurybackground");
        AgreementForm.style.height = document.body.clientHeight  + "px";
        AgreementForm.style.width = window.screen.availWidth + "px";

        var ContainerElem = document.getElementById("salesFroceSource_StatusBox");
        //ContainerElem.style.display = "block";
        AlignToCenter(ContainerElem);

    function AlignToCenter(Element)
    {
        var availableHeight = 0;
        var availableWidth = 0;
        if (Element.ownerDocument)
        {
            var docElement = Element.ownerDocument.documentElement;
            availableHeight = parseInt(docElement.clientHeight);
            if (availableHeight == "NaN") availableHeight = 0;

            availableWidth = parseInt(docElement.clientWidth);
            if (availableWidth == "NaN") availableWidth = 0;
        }

        if (availableHeight == 0 || availableHeight == "NaN")
        availableHeight = window.screen.availHeight - 200;
        if (availableWidth == 0 || availableWidth == "NaN")
        availableWidth = window.screen.availWidth - 100;

        var msgBoxTop = parseInt((availableHeight - parseInt(Element.clientHeight))/2);
        var msgBoxleft = parseInt((availableWidth - parseInt(Element.style.width))/2);

        if (msgBoxTop == "NaN" || msgBoxTop == 0)
        msgBoxTop = 50;

        Element.style.left = msgBoxleft + "px";
        Element.style.top = msgBoxTop + "px";
    }        
    </script>
</apex:page>